<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyBuddy Pro - MBA Exam Prep Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --color-primary: #2563eb;
            --color-primary-hover: #1d4ed8;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-bg: #ffffff;
            --color-surface: #f8fafc;
            --color-text: #1e293b;
            --color-text-secondary: #64748b;
            --color-border: #e2e8f0;
            --color-shadow: rgba(0, 0, 0, 0.1);
        }

        [data-color-scheme="dark"] {
            --color-primary: #3b82f6;
            --color-primary-hover: #60a5fa;
            --color-success: #34d399;
            --color-warning: #fbbf24;
            --color-danger: #f87171;
            --color-bg: #0f172a;
            --color-surface: #1e293b;
            --color-text: #f1f5f9;
            --color-text-secondary: #94a3b8;
            --color-border: #334155;
            --color-shadow: rgba(0, 0, 0, 0.3);
        }

        @media (prefers-color-scheme: dark) {
            :root:not([data-color-scheme="light"]) {
                --color-primary: #3b82f6;
                --color-primary-hover: #60a5fa;
                --color-success: #34d399;
                --color-warning: #fbbf24;
                --color-danger: #f87171;
                --color-bg: #0f172a;
                --color-surface: #1e293b;
                --color-text: #f1f5f9;
                --color-text-secondary: #94a3b8;
                --color-border: #334155;
                --color-shadow: rgba(0, 0, 0, 0.3);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Header */
        header {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px var(--color-shadow);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Navigation */
        nav {
            background: var(--color-surface);
            padding: 0.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: nowrap;
            min-width: min-content;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .nav-tab:hover {
            background: var(--color-bg);
            color: var(--color-text);
        }

        .nav-tab.active {
            background: var(--color-primary);
            color: white;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: var(--color-bg);
        }

        .btn-danger {
            background: var(--color-danger);
            color: white;
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .btn-warning {
            background: var(--color-warning);
            color: white;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .btn-block {
            width: 100%;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            background: var(--color-surface);
            color: var(--color-text);
        }

        /* Cards */
        .card {
            background: var(--color-surface);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px var(--color-shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--color-text);
        }

        .card-subtitle {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--color-text);
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-bg);
            color: var(--color-text);
            font-size: 0.95rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Grid */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* Lists */
        .list-item {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s;
        }

        .list-item:hover {
            box-shadow: 0 4px 12px var(--color-shadow);
            transform: translateY(-2px);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .list-title {
            font-weight: 600;
            color: var(--color-text);
            font-size: 1.05rem;
        }

        .list-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        .list-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            margin-top: 0.5rem;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--color-warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--color-danger);
        }

        .badge-primary {
            background: rgba(37, 99, 235, 0.1);
            color: var(--color-primary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-bg);
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            font-size: 1.5rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--color-surface);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px var(--color-shadow);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px var(--color-shadow);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--color-primary);
        }

        .stat-label {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Auth */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .auth-card {
            background: var(--color-surface);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px var(--color-shadow);
            max-width: 400px;
            width: 100%;
        }

        .auth-title {
            font-size: 1.75rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--color-primary);
        }

        .auth-toggle {
            text-align: center;
            margin-top: 1rem;
            color: var(--color-text-secondary);
        }

        .auth-toggle a {
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-toggle a:hover {
            text-decoration: underline;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 1rem 0;
        }

        /* Pomodoro Timer */
        .pomodoro-timer {
            text-align: center;
            padding: 2rem;
        }

        .timer-display {
            font-size: 4rem;
            font-weight: bold;
            color: var(--color-primary);
            margin: 2rem 0;
            font-variant-numeric: tabular-nums;
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Study Tracker */
        .session-input {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        /* AI Advisor */
        .ai-chat {
            background: var(--color-surface);
            border-radius: 8px;
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .ai-message {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            background: var(--color-bg);
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--color-border);
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
            }

            nav {
                margin: 0.5rem 0;
            }

            .nav-tabs {
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }

            .timer-display {
                font-size: 3rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .hidden {
            display: none !important;
        }

        /* Sync Status Indicator */
        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .sync-dot.offline {
            background: var(--color-danger);
            animation: none;
        }

        /* Offline Banner */
        .offline-banner {
            background: var(--color-warning);
            color: white;
            padding: 0.75rem;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 200;
            display: none;
        }

        .offline-banner.show {
            display: block;
        }

        /* Toast Notification Styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            min-width: 300px;
            max-width: 400px;
            padding: 16px 20px;
            background: var(--color-surface);
            border-left: 4px solid var(--color-primary);
            border-radius: 8px;
            box-shadow: 0 4px 12px var(--color-shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
            transition: opacity 0.3s ease;
        }

        .toast.success {
            border-left-color: var(--color-success);
        }

        .toast.error {
            border-left-color: var(--color-danger);
        }

        .toast.warning {
            border-left-color: var(--color-warning);
        }

        .toast-icon {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
        }

        .toast-content {
            flex: 1;
            color: var(--color-text);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
        }

        .toast-close:hover {
            color: var(--color-text);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .toast.removing {
            animation: slideOut 0.3s ease-out;
        }

    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Offline Banner -->
    <div class="offline-banner" id="offlineBanner">
        ‚ö†Ô∏è You are offline. Changes will sync when you're back online.
        <button class="btn btn-sm btn-secondary" onclick="continueOffline()" style="margin-left: 1rem;">Continue Offline</button>
    </div>

    <!-- Auth Section -->
    <div id="authSection" class="auth-container">
        <div class="auth-card">
            <div class="auth-title">
                <span>üìö StudyBuddy Pro</span>
            </div>
            
            <div id="loginForm">
                <h2 style="text-align: center; margin-bottom: 1.5rem;">Login</h2>
                <form onsubmit="signIn(event)">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Login</button>
                </form>
                <div class="auth-toggle">
                    Don't have an account? <a href="#" onclick="document.getElementById('loginForm').classList.add('hidden'); document.getElementById('signupForm').classList.remove('hidden'); return false;">Sign Up</a>
                </div>
            </div>

            <div id="signupForm" class="hidden">
                <h2 style="text-align: center; margin-bottom: 1.5rem;">Sign Up</h2>
                <form onsubmit="signUp(event)">
                    <div class="form-group">
                        <label class="form-label" for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Sign Up</button>
                </form>
                <div class="auth-toggle">
                    Already have an account? <a href="#" onclick="document.getElementById('signupForm').classList.add('hidden'); document.getElementById('loginForm').classList.remove('hidden'); return false;">Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo">
                    <span>üìö</span>
                    <span>StudyBuddy Pro</span>
                </div>
                <div class="header-actions">
                    <div class="sync-status">
                        <div class="sync-dot" id="syncDot"></div>
                        <span id="syncStatus">Synced</span>
                    </div>
                    <span id="userEmail" style="color: var(--color-text-secondary);"></span>
                    <button class="icon-btn" onclick="toggleTheme()" id="themeBtn">
                        <i data-lucide="sun"></i>
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="handleLogout()">Logout</button>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- Navigation -->
            <nav>
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="switchTab('dashboard')">
                        üìä Dashboard
                    </button>
                    <button class="nav-tab" onclick="switchTab('mockTests')">
                        üìù Mock Tests
                    </button>
                    <button class="nav-tab" onclick="switchTab('errorLog')">
                        üéØ Error Log
                    </button>
                    <button class="nav-tab" onclick="switchTab('goals')">
                        ‚≠ê Goals
                    </button>
                    <button class="nav-tab" onclick="switchTab('studyTracker')">
                        ‚è±Ô∏è Study Tracker
                    </button>
                    <button class="nav-tab" onclick="switchTab('pomodoro')">
                        üçÖ Pomodoro
                    </button>
                    <button class="nav-tab" onclick="switchTab('resources')">
                        üìö Resources
                    </button>
                    <button class="nav-tab" onclick="switchTab('aiAdvisor')">
                        ü§ñ AI Advisor
                    </button>
                    <button class="nav-tab" onclick="switchTab('profile')">
                        üë§ Profile
                    </button>
                    <button class="nav-tab" onclick="switchTab('settings')">
                        ‚öôÔ∏è Settings
                    </button>
                </div>
            </nav>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalMockTests">0</div>
                        <div class="stat-label">Mock Tests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalErrors">0</div>
                        <div class="stat-label">Errors Logged</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalGoals">0</div>
                        <div class="stat-label">Study Goals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgScore">0%</div>
                        <div class="stat-label">Average Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="studyHours">0</div>
                        <div class="stat-label">Study Hours</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="studyStreak">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Performance Overview</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Mock Tests</h3>
                            <button class="btn btn-sm btn-primary" onclick="switchTab('mockTests'); showAddMockModal()">
                                <i data-lucide="plus"></i> Add
                            </button>
                        </div>
                        <div id="recentMocks"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Active Goals</h3>
                            <button class="btn btn-sm btn-primary" onclick="switchTab('goals'); showAddGoalModal()">
                                <i data-lucide="plus"></i> Add
                            </button>
                        </div>
                        <div id="activeGoals"></div>
                    </div>
                </div>
            </div>

            <!-- Mock Tests Tab -->
            <div id="mockTests" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Mock Tests</h2>
                            <p class="card-subtitle">Track your mock test performance</p>
                        </div>
                        <button class="btn btn-primary" onclick="showAddMockModal()">
                            <i data-lucide="plus"></i> Add Mock Test
                        </button>
                    </div>
                    <div id="mockTestsList"></div>
                </div>
            </div>

            <!-- Error Log Tab -->
            <div id="errorLog" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Error Log</h2>
                            <p class="card-subtitle">Keep track of your mistakes to improve faster</p>
                        </div>
                        <button class="btn btn-primary" onclick="showAddErrorModal()">
                            <i data-lucide="plus"></i> Add Error
                        </button>
                    </div>
                    <div id="errorLogList"></div>
                </div>
            </div>

            <!-- Goals Tab -->
            <div id="goals" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Study Goals</h2>
                            <p class="card-subtitle">Set and track your study objectives</p>
                        </div>
                        <button class="btn btn-primary" onclick="showAddGoalModal()">
                            <i data-lucide="plus"></i> Add Goal
                        </button>
                    </div>
                    <div id="goalsList"></div>
                </div>
            </div>

            <!-- Study Tracker Tab -->
            <div id="studyTracker" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Study Tracker</h2>
                        <p class="card-subtitle">Log your daily study sessions</p>
                    </div>
                    
                    <div class="session-input">
                        <select id="studyType" class="form-control" style="flex: 1; min-width: 200px;">
                            <option value="">Select Study Type</option>
                            <option value="Quantitative Aptitude">Quantitative Aptitude</option>
                            <option value="Verbal Ability">Verbal Ability</option>
                            <option value="Data Interpretation">Data Interpretation</option>
                            <option value="Logical Reasoning">Logical Reasoning</option>
                            <option value="General Knowledge">General Knowledge</option>
                            <option value="Mock Test">Mock Test</option>
                            <option value="Revision">Revision</option>
                        </select>
                        <input type="number" id="studyHoursInput" placeholder="Hours" min="0" max="24" step="0.5" style="flex: 0 0 100px;">
                        <button class="btn btn-success" onclick="startStudySession()">
                            <i data-lucide="play"></i> Start Session
                        </button>
                        <button class="btn btn-danger" onclick="endStudySession()">
                            <i data-lucide="stop"></i> End Session
                        </button>
                    </div>

                    <div id="currentSession" class="hidden" style="background: var(--color-bg); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <h3 style="margin-bottom: 0.5rem;">Current Session</h3>
                        <p><strong>Type:</strong> <span id="currentSessionType"></span></p>
                        <p><strong>Started:</strong> <span id="currentSessionStart"></span></p>
                        <p><strong>Duration:</strong> <span id="currentSessionDuration">0:00:00</span></p>
                    </div>

                    <div id="studyHistory"></div>
                </div>
            </div>

            <!-- Pomodoro Tab -->
            <div id="pomodoro" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Pomodoro Timer</h2>
                        <p class="card-subtitle">25 minutes of focused study, 5 minutes break</p>
                    </div>
                    
                    <div class="pomodoro-timer">
                        <div class="timer-display" id="timerDisplay">25:00</div>
                        <div class="timer-controls">
                            <button class="btn btn-success btn-lg" onclick="startPomodoro()">
                                <i data-lucide="play"></i> Start
                            </button>
                            <button class="btn btn-warning btn-lg" onclick="pausePomodoro()">
                                <i data-lucide="pause"></i> Pause
                            </button>
                            <button class="btn btn-danger btn-lg" onclick="resetPomodoro()">
                                <i data-lucide="rotate-ccw"></i> Reset
                            </button>
                        </div>
                        <p id="pomodoroStatus" style="margin-top: 2rem; font-size: 1.2rem;">Ready to start</p>
                    </div>
                </div>
            </div>

            <!-- Resources Tab -->
            <div id="resources" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Study Resources</h2>
                            <p class="card-subtitle">Save important study materials and links</p>
                        </div>
                        <button class="btn btn-primary" onclick="showAddResourceModal()">
                            <i data-lucide="plus"></i> Add Resource
                        </button>
                    </div>
                    <div id="resourcesList"></div>
                </div>
            </div>

            <!-- AI Advisor Tab -->
            <div id="aiAdvisor" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ü§ñ AI Study Advisor</div>
                        <p class="card-subtitle">Get personalized study advice based on your performance</p>
                    </div>
                    
                    <div class="grid grid-3" style="margin-bottom: 1.5rem;">
                        <button class="btn btn-secondary" onclick="generatePerformanceAnalysis()">
                            üìä Performance Analysis
                        </button>
                        <button class="btn btn-secondary" onclick="generateWeaknessAnalysis()">
                            üéØ Weakness Analysis
                        </button>
                        <button class="btn btn-secondary" onclick="generateStudyPlan()">
                            üìù Study Plan
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ask AI Advisor</label>
                        <textarea id="aiQuestion" placeholder="Ask me anything about your MBA preparation, study strategies, time management, etc..." style="min-height: 120px;"></textarea>
                    </div>
                    <button class="btn btn-success btn-block" onclick="askAIAdvisor()">
                        <i data-lucide="send"></i> Get AI Advice
                    </button>

                    <div id="aiResponse" class="ai-chat hidden"></div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Profile</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" id="profileName" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Target Exam</label>
                        <select id="targetExam">
                            <option value="CAT">CAT</option>
                            <option value="XAT">XAT</option>
                            <option value="SNAP">SNAP</option>
                            <option value="NMAT">NMAT</option>
                            <option value="Multiple">Multiple Exams</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Target Score</label>
                        <input type="number" id="targetScore" placeholder="e.g., 99" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Target Colleges (comma-separated)</label>
                        <textarea id="targetColleges" placeholder="e.g., IIM-A, IIM-B, IIM-C, XLRI, FMS"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Daily Study Goal (hours)</label>
                        <input type="number" id="dailyGoal" placeholder="e.g., 6" min="0" max="24" step="0.5">
                    </div>
                    <button class="btn btn-primary" onclick="saveProfile()">Save Profile</button>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Settings</h2>
                    </div>
                    
                    <div class="form-group">
                        <h3 style="margin-bottom: 1rem;">Data Management</h3>
                        <div class="grid grid-2">
                            <button class="btn btn-secondary" onclick="exportToJSON()">
                                <i data-lucide="download"></i> Export JSON
                            </button>
                            <button class="btn btn-secondary" onclick="exportToExcel()">
                                <i data-lucide="download"></i> Export Excel
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <h3 style="margin-bottom: 1rem;">Import Data</h3>
                        <input type="file" id="importFile" accept=".json" style="margin-bottom: 0.5rem;">
                        <button class="btn btn-secondary btn-block" onclick="importData()">
                            <i data-lucide="upload"></i> Import from File
                        </button>
                    </div>

                    <div class="form-group">
                        <h3 style="margin-bottom: 1rem;">Danger Zone</h3>
                        <button class="btn btn-danger btn-block" onclick="confirmClearData()">
                            <i data-lucide="trash-2"></i> Clear All Local Data
                        </button>
                        <p style="color: var(--color-text-secondary); font-size: 0.85rem; margin-top: 0.5rem;">
                            This will clear all data stored locally. Your data in Firebase will remain safe.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Mock Test Modal -->
    <div id="addMockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Mock Test</h2>
                <button class="modal-close" onclick="closeModal('addMockModal')">√ó</button>
            </div>
            <form onsubmit="addMockTest(event)">
                <div class="form-group">
                    <label class="form-label">Test Name</label>
                    <input type="text" id="mockName" required placeholder="e.g., CAT Mock 15">
                </div>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="mockDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Exam</label>
                        <select id="mockExam" required>
                            <option value="">Select Exam</option>
                            <option value="CAT">CAT</option>
                            <option value="XAT">XAT</option>
                            <option value="SNAP">SNAP</option>
                            <option value="NMAT">NMAT</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-3">
                    <div class="form-group">
                        <label class="form-label">Score</label>
                        <input type="number" id="mockScore" required min="0" placeholder="85">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total</label>
                        <input type="number" id="mockTotal" required min="1" placeholder="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Percentile</label>
                        <input type="number" id="mockPercentile" min="0" max="100" step="0.01" placeholder="95.5">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea id="mockNotes" placeholder="What went well? What needs improvement?"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addMockModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Error Modal -->
    <div id="addErrorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Log Error</h2>
                <button class="modal-close" onclick="closeModal('addErrorModal')">√ó</button>
            </div>
            <form onsubmit="addError(event)">
                <div class="form-group">
                    <label class="form-label">Subject</label>
                    <select id="errorSubject" required>
                        <option value="">Select Subject</option>
                        <option value="Quantitative Aptitude">Quantitative Aptitude</option>
                        <option value="Verbal Ability">Verbal Ability</option>
                        <option value="Data Interpretation">Data Interpretation</option>
                        <option value="Logical Reasoning">Logical Reasoning</option>
                        <option value="General Knowledge">General Knowledge</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Topic</label>
                    <input type="text" id="errorTopic" required placeholder="e.g., Probability, Reading Comprehension">
                </div>
                <div class="form-group">
                    <label class="form-label">Question</label>
                    <textarea id="errorQuestion" required placeholder="Describe the question or paste it here"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Mistake</label>
                    <textarea id="errorMistake" required placeholder="What did you get wrong?"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Correct Approach</label>
                    <textarea id="errorCorrectApproach" required placeholder="What's the right way to solve this?"></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addErrorModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Goal Modal -->
    <div id="addGoalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Study Goal</h2>
                <button class="modal-close" onclick="closeModal('addGoalModal')">√ó</button>
            </div>
            <form onsubmit="addGoal(event)">
                <div class="form-group">
                    <label class="form-label">Goal Title</label>
                    <input type="text" id="goalTitle" required placeholder="e.g., Complete 50 mock tests">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="goalDescription" placeholder="More details about this goal..."></textarea>
                </div>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">Deadline</label>
                        <input type="date" id="goalDeadline" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <select id="goalPriority" required>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addGoalModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Resource Modal -->
    <div id="addResourceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Resource</h2>
                <button class="modal-close" onclick="closeModal('addResourceModal')">√ó</button>
            </div>
            <form onsubmit="addResource(event)">
                <div class="form-group">
                    <label class="form-label">Resource Title</label>
                    <input type="text" id="resourceTitle" required placeholder="e.g., Quant Formula Sheet">
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="url" id="resourceURL" required placeholder="https://...">
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select id="resourceCategory" required>
                        <option value="">Select Category</option>
                        <option value="Quantitative">Quantitative</option>
                        <option value="Verbal">Verbal</option>
                        <option value="DI">Data Interpretation</option>
                        <option value="LR">Logical Reasoning</option>
                        <option value="GK">General Knowledge</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea id="resourceNotes" placeholder="Additional notes about this resource..."></textarea>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addResourceModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCo2dPho0a0yAl_OgpHu6nAHIMG8LtCZOo",
            authDomain: "studdybuddy-beb37.firebaseapp.com",
            databaseURL: "https://studdybuddy-beb37-default-rtdb.firebaseio.com",
            projectId: "studdybuddy-beb37",
            storageBucket: "studdybuddy-beb37.appspot.com",
            messagingSenderId: "878987447671",
            appId: "1:878987447671:web:1c75aef1d3bbf0b0e04391"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global State
        let appData = {
            mockTests: [],
            errors: [],
            goals: [],
            studySessions: [],
            resources: [],
            profile: {}
        };

        let performanceChart = null;
        let pomodoroTimer = null;
        let pomodoroMinutes = 25;
        let pomodoroSeconds = 0;
        let pomodoroRunning = false;
        let currentStudySession = null;
        let sessionInterval = null;

        // Toast Notification System
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'check-circle',
                error: 'alert-circle',
                warning: 'alert-triangle',
                info: 'info'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i data-lucide="${icons[type] || 'info'}"></i>
                </div>
                <div class="toast-content">${message}</div>
                <button class="toast-close" onclick="removeToast(this)">
                    <i data-lucide="x"></i>
                </button>
            `;
            
            container.appendChild(toast);
            lucide.createIcons();
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                removeToast(toast.querySelector('.toast-close'));
            }, 5000);
        }

        function removeToast(button) {
            const toast = button.closest('.toast');
            toast.classList.add('removing');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }


        // Authentication
        function signIn(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showToast('Please enter email and password', 'error');
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    showToast('Login successful! Welcome back.', 'success');
                })
                .catch((error) => {
                    showToast('Error: ' + error.message, 'error');
                });
        }

        function signUp(event) {
            event.preventDefault();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (!email || !password) {
                showToast('Please enter email and password', 'error');
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(() => {
                    showToast('Account created successfully! Welcome to StudyBuddy Pro.', 'success');
                })
                .catch((error) => {
                    showToast('Error: ' + error.message, 'error');
                });
        }

        function handleLogout() {
            auth.signOut()
                .then(() => {
                    showToast('Logged out successfully', 'success');
                })
                .catch((error) => {
                    showToast('Error: ' + error.message, 'error');
                });
        }

        // Auth State Observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                updateAuthUI(user);
                loadUserData();
                
                // Load theme from Firebase
                database.ref('users/' + user.uid + '/theme').once('value').then(snapshot => {
                    if (snapshot.exists()) {
                        document.documentElement.setAttribute('data-color-scheme', snapshot.val());
                    }
                }).catch(err => console.error('Failed to load theme:', err));
            } else {
                document.getElementById('authSection').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        });

        function updateAuthUI(user) {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userEmail').textContent = user.email;
        }

        // Data Management
        async function loadUserData() {
            if (!auth.currentUser) return;
            
            try {
                const snapshot = await database.ref('users/' + auth.currentUser.uid).once('value');
                if (snapshot.exists()) {
                    appData = {
                        mockTests: snapshot.val().mockTests || [],
                        errors: snapshot.val().errors || [],
                        goals: snapshot.val().goals || [],
                        studySessions: snapshot.val().studySessions || [],
                        resources: snapshot.val().resources || [],
                        profile: snapshot.val().profile || {}
                    };
                }
                refreshUI();
                updateSyncStatus(true);
            } catch (error) {
                console.error('Failed to load data:', error);
                showToast('Failed to load data: ' + error.message, 'error');
                updateSyncStatus(false);
            }
        }

        async function saveUserData() {
            if (!auth.currentUser) return;
            
            try {
                await database.ref('users/' + auth.currentUser.uid).set(appData);
                updateSyncStatus(true);
            } catch (error) {
                console.error('Failed to save:', error);
                showToast('Failed to save data: ' + error.message, 'error');
                updateSyncStatus(false);
            }
        }

        function updateSyncStatus(synced) {
            const dot = document.getElementById('syncDot');
            const status = document.getElementById('syncStatus');
            if (synced) {
                dot.classList.remove('offline');
                status.textContent = 'Synced';
            } else {
                dot.classList.add('offline');
                status.textContent = 'Offline';
            }
        }

        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-color-scheme') || 
                                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-color-scheme', newTheme);
            
            // Save theme to Firebase
            if (auth.currentUser) {
                database.ref('users/' + auth.currentUser.uid + '/theme').set(newTheme).catch(err => {
                    console.error('Failed to save theme:', err);
                });
            }
            
            lucide.createIcons();
        }

        // Navigation
        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            // Refresh specific tab data
            if (tabId === 'dashboard') updateDashboard();
            if (tabId === 'profile') loadProfile();
        }

        // Mock Tests
        function showAddMockModal() {
            document.getElementById('addMockModal').classList.add('active');
            document.getElementById('mockDate').valueAsDate = new Date();
        }

        function addMockTest(event) {
            event.preventDefault();
            
            const mockTest = {
                id: Date.now().toString(),
                name: document.getElementById('mockName').value.trim(),
                date: document.getElementById('mockDate').value,
                exam: document.getElementById('mockExam').value,
                score: parseFloat(document.getElementById('mockScore').value),
                total: parseFloat(document.getElementById('mockTotal').value),
                percentile: parseFloat(document.getElementById('mockPercentile').value) || null,
                notes: document.getElementById('mockNotes').value.trim(),
                timestamp: new Date().toISOString()
            };
            
            mockTest.percentage = ((mockTest.score / mockTest.total) * 100).toFixed(2);
            
            appData.mockTests.push(mockTest);
            saveUserData();
            renderMockTests();
            closeModal('addMockModal');
            event.target.reset();
            showToast('Mock test added successfully!', 'success');
        }

        function deleteMockTest(id) {
            if (confirm('Are you sure you want to delete this mock test?')) {
                appData.mockTests = appData.mockTests.filter(t => t.id !== id);
                saveUserData();
                renderMockTests();
                showToast('Mock test deleted', 'info');
            }
        }

        function renderMockTests() {
            const container = document.getElementById('mockTestsList');
            
            if (appData.mockTests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p>No mock tests yet. Add your first mock test to track your performance!</p>
                    </div>
                `;
                return;
            }
            
            const sorted = [...appData.mockTests].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sorted.map(test => `
                <div class="list-item">
                    <div class="list-header">
                        <div>
                            <div class="list-title">${test.name}</div>
                            <div class="list-meta">
                                <span class="badge badge-primary">${test.exam}</span>
                                <span>${new Date(test.date).toLocaleDateString()}</span>
                                <span><strong>Score:</strong> ${test.score}/${test.total} (${test.percentage}%)</span>
                                ${test.percentile ? `<span><strong>Percentile:</strong> ${test.percentile}%</span>` : ''}
                            </div>
                            ${test.notes ? `<p style="margin-top: 0.5rem; color: var(--color-text-secondary);">${test.notes}</p>` : ''}
                        </div>
                        <div class="list-actions">
                            <button class="icon-btn" onclick="deleteMockTest('${test.id}')" title="Delete">
                                <i data-lucide="trash-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // Error Log
        function showAddErrorModal() {
            document.getElementById('addErrorModal').classList.add('active');
        }

        function addError(event) {
            event.preventDefault();
            
            const subject = document.getElementById('errorSubject').value;
            if (!subject) {
                showToast('Please select a subject', 'warning');
                return;
            }
            
            const error = {
                id: Date.now().toString(),
                subject: subject,
                topic: document.getElementById('errorTopic').value.trim(),
                question: document.getElementById('errorQuestion').value.trim(),
                mistake: document.getElementById('errorMistake').value.trim(),
                correctApproach: document.getElementById('errorCorrectApproach').value.trim(),
                timestamp: new Date().toISOString()
            };
            
            appData.errors.push(error);
            saveUserData();
            renderErrorLog();
            closeModal('addErrorModal');
            event.target.reset();
            showToast('Error logged successfully!', 'success');
        }

        function deleteError(id) {
            if (confirm('Are you sure you want to delete this error log?')) {
                appData.errors = appData.errors.filter(e => e.id !== id);
                saveUserData();
                renderErrorLog();
                showToast('Error deleted', 'info');
            }
        }

        function renderErrorLog() {
            const container = document.getElementById('errorLogList');
            
            if (appData.errors.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üéØ</div>
                        <p>No errors logged yet. Keep track of your mistakes to improve faster!</p>
                    </div>
                `;
                return;
            }
            
            const sorted = [...appData.errors].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = sorted.map(error => `
                <div class="list-item">
                    <div class="list-header">
                        <div style="flex: 1;">
                            <div class="list-title">${error.topic}</div>
                            <div class="list-meta">
                                <span class="badge badge-warning">${error.subject}</span>
                                <span>${new Date(error.timestamp).toLocaleDateString()}</span>
                            </div>
                            <div style="margin-top: 0.75rem;">
                                <p style="margin-bottom: 0.5rem;"><strong>Question:</strong> ${error.question}</p>
                                <p style="margin-bottom: 0.5rem; color: var(--color-danger);"><strong>Your Mistake:</strong> ${error.mistake}</p>
                                <p style="color: var(--color-success);"><strong>Correct Approach:</strong> ${error.correctApproach}</p>
                            </div>
                        </div>
                        <div class="list-actions">
                            <button class="icon-btn" onclick="deleteError('${error.id}')" title="Delete">
                                <i data-lucide="trash-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // Goals
        function showAddGoalModal() {
            document.getElementById('addGoalModal').classList.add('active');
        }

        function addGoal(event) {
            event.preventDefault();
            
            const goal = {
                id: Date.now().toString(),
                title: document.getElementById('goalTitle').value.trim(),
                description: document.getElementById('goalDescription').value.trim(),
                deadline: document.getElementById('goalDeadline').value,
                priority: document.getElementById('goalPriority').value,
                completed: false,
                timestamp: new Date().toISOString()
            };
            
            appData.goals.push(goal);
            saveUserData();
            renderGoals();
            closeModal('addGoalModal');
            event.target.reset();
            showToast('Goal added successfully!', 'success');
        }

        function deleteGoal(id) {
            if (confirm('Are you sure you want to delete this goal?')) {
                appData.goals = appData.goals.filter(g => g.id !== id);
                saveUserData();
                renderGoals();
                showToast('Goal deleted', 'info');
            }
        }

        function toggleGoalComplete(id) {
            const goal = appData.goals.find(g => g.id === id);
            if (goal) {
                goal.completed = !goal.completed;
                saveUserData();
                renderGoals();
            }
        }

        function renderGoals() {
            const container = document.getElementById('goalsList');
            
            if (appData.goals.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚≠ê</div>
                        <p>No study goals yet. Set your study goals to stay motivated!</p>
                    </div>
                `;
                return;
            }
            
            const sorted = [...appData.goals].sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                const priorityOrder = { high: 0, medium: 1, low: 2 };
                return priorityOrder[a.priority] - priorityOrder[b.priority];
            });
            
            container.innerHTML = sorted.map(goal => {
                const isOverdue = new Date(goal.deadline) < new Date() && !goal.completed;
                const priorityColors = {
                    high: 'badge-danger',
                    medium: 'badge-warning',
                    low: 'badge-success'
                };
                
                return `
                    <div class="list-item" style="${goal.completed ? 'opacity: 0.6;' : ''}">
                        <div class="list-header">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <input type="checkbox" ${goal.completed ? 'checked' : ''} 
                                           onchange="toggleGoalComplete('${goal.id}')"
                                           style="width: 20px; height: 20px; cursor: pointer;">
                                    <div class="list-title" style="${goal.completed ? 'text-decoration: line-through;' : ''}">${goal.title}</div>
                                </div>
                                ${goal.description ? `<p style="margin: 0.5rem 0; margin-left: 2rem; color: var(--color-text-secondary);">${goal.description}</p>` : ''}
                                <div class="list-meta" style="margin-left: 2rem;">
                                    <span class="badge ${priorityColors[goal.priority]}">${goal.priority.toUpperCase()}</span>
                                    <span><strong>Deadline:</strong> ${new Date(goal.deadline).toLocaleDateString()}</span>
                                    ${isOverdue ? '<span class="badge badge-danger">OVERDUE</span>' : ''}
                                    ${goal.completed ? '<span class="badge badge-success">COMPLETED</span>' : ''}
                                </div>
                            </div>
                            <div class="list-actions">
                                <button class="icon-btn" onclick="deleteGoal('${goal.id}')" title="Delete">
                                    <i data-lucide="trash-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        // Study Tracker
        function startStudySession() {
            const type = document.getElementById('studyType').value;
            if (!type) {
                showToast('Please select a study type', 'warning');
                return;
            }
            
            currentStudySession = {
                type: type,
                startTime: new Date(),
                duration: 0
            };
            
            document.getElementById('currentSession').classList.remove('hidden');
            document.getElementById('currentSessionType').textContent = type;
            document.getElementById('currentSessionStart').textContent = currentStudySession.startTime.toLocaleTimeString();
            
            sessionInterval = setInterval(() => {
                const now = new Date();
                const diff = Math.floor((now - currentStudySession.startTime) / 1000);
                const hours = Math.floor(diff / 3600);
                const minutes = Math.floor((diff % 3600) / 60);
                const seconds = diff % 60;
                document.getElementById('currentSessionDuration').textContent = 
                    `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
            
            showToast('Study session started!', 'success');
        }

        function endStudySession() {
            if (!currentStudySession) {
                showToast('No active session', 'warning');
                return;
            }
            
            clearInterval(sessionInterval);
            
            const endTime = new Date();
            const durationMs = endTime - currentStudySession.startTime;
            const hours = (durationMs / (1000 * 60 * 60)).toFixed(2);
            
            const session = {
                id: Date.now().toString(),
                type: currentStudySession.type,
                startTime: currentStudySession.startTime.toISOString(),
                endTime: endTime.toISOString(),
                duration: hours,
                date: currentStudySession.startTime.toLocaleDateString()
            };
            
            appData.studySessions.push(session);
            saveUserData();
            
            document.getElementById('currentSession').classList.add('hidden');
            currentStudySession = null;
            
            showToast('Session saved!', 'success');
            renderStudyHistory();
        }

        function renderStudyHistory() {
            const container = document.getElementById('studyHistory');
            if (!appData.studySessions || appData.studySessions.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No study sessions logged yet</p></div>';
                return;
            }
            
            const sorted = [...appData.studySessions].sort((a, b) => new Date(b.startTime) - new Date(a.startTime));
            const recent = sorted.slice(0, 10);
            
            container.innerHTML = '<h3 style="margin-top: 2rem; margin-bottom: 1rem;">Recent Sessions</h3>' + 
                recent.map(session => `
                    <div class="list-item">
                        <div class="list-header">
                            <div>
                                <div class="list-title">${session.type}</div>
                                <div class="list-meta">
                                    <span>${session.date}</span>
                                    <span><strong>Duration:</strong> ${session.duration} hours</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            
            lucide.createIcons();
        }

        // Pomodoro Timer
        function startPomodoro() {
            if (pomodoroRunning) return;
            
            pomodoroRunning = true;
            document.getElementById('pomodoroStatus').textContent = 'Focus time! üéØ';
            
            pomodoroTimer = setInterval(() => {
                if (pomodoroSeconds === 0) {
                    if (pomodoroMinutes === 0) {
                        clearInterval(pomodoroTimer);
                        pomodoroRunning = false;
                        document.getElementById('pomodoroStatus').textContent = 'Time for a break! ‚òï';
                        showToast('Pomodoro session complete! Take a 5 minute break.', 'success');
                        // Auto reset to 25 minutes
                        pomodoroMinutes = 25;
                        updateTimerDisplay();
                        return;
                    }
                    pomodoroMinutes--;
                    pomodoroSeconds = 59;
                } else {
                    pomodoroSeconds--;
                }
                updateTimerDisplay();
            }, 1000);
        }

        function pausePomodoro() {
            if (pomodoroTimer) {
                clearInterval(pomodoroTimer);
                pomodoroRunning = false;
                document.getElementById('pomodoroStatus').textContent = 'Paused';
            }
        }

        function resetPomodoro() {
            if (pomodoroTimer) {
                clearInterval(pomodoroTimer);
            }
            pomodoroRunning = false;
            pomodoroMinutes = 25;
            pomodoroSeconds = 0;
            updateTimerDisplay();
            document.getElementById('pomodoroStatus').textContent = 'Ready to start';
        }

        function updateTimerDisplay() {
            const display = `${pomodoroMinutes.toString().padStart(2, '0')}:${pomodoroSeconds.toString().padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        // Resources
        function showAddResourceModal() {
            document.getElementById('addResourceModal').classList.add('active');
        }

        function addResource(event) {
            event.preventDefault();
            
            const resource = {
                id: Date.now().toString(),
                title: document.getElementById('resourceTitle').value.trim(),
                url: document.getElementById('resourceURL').value.trim(),
                category: document.getElementById('resourceCategory').value,
                notes: document.getElementById('resourceNotes').value.trim(),
                timestamp: new Date().toISOString()
            };
            
            appData.resources.push(resource);
            saveUserData();
            renderResources();
            closeModal('addResourceModal');
            event.target.reset();
            showToast('Resource added!', 'success');
        }

        function deleteResource(id) {
            if (confirm('Are you sure you want to delete this resource?')) {
                appData.resources = appData.resources.filter(r => r.id !== id);
                saveUserData();
                renderResources();
                showToast('Resource deleted', 'info');
            }
        }

        function renderResources() {
            const container = document.getElementById('resourcesList');
            
            if (!appData.resources || appData.resources.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <p>No resources yet. Add your study materials and links!</p>
                    </div>
                `;
                return;
            }
            
            const sorted = [...appData.resources].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = sorted.map(resource => `
                <div class="list-item">
                    <div class="list-header">
                        <div style="flex: 1;">
                            <div class="list-title">
                                <a href="${resource.url}" target="_blank" rel="noopener noreferrer" style="color: var(--color-primary);">
                                    ${resource.title} <i data-lucide="external-link" style="width: 16px; height: 16px;"></i>
                                </a>
                            </div>
                            <div class="list-meta">
                                <span class="badge badge-primary">${resource.category}</span>
                                <span>${new Date(resource.timestamp).toLocaleDateString()}</span>
                            </div>
                            ${resource.notes ? `<p style="margin-top: 0.5rem; color: var(--color-text-secondary);">${resource.notes}</p>` : ''}
                        </div>
                        <div class="list-actions">
                            <button class="icon-btn" onclick="deleteResource('${resource.id}')" title="Delete">
                                <i data-lucide="trash-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        // AI Advisor (placeholder functions)
        function generatePerformanceAnalysis() {
            const response = document.getElementById('aiResponse');
            response.classList.remove('hidden');
            response.innerHTML = '<div class="spinner"></div>';
            
            setTimeout(() => {
                const avgScore = appData.mockTests.length > 0 
                    ? (appData.mockTests.reduce((sum, t) => sum + parseFloat(t.percentage), 0) / appData.mockTests.length).toFixed(1)
                    : 0;
                
                response.innerHTML = `
                    <div class="ai-message">
                        <h4 style="margin-bottom: 0.5rem;">üìä Performance Analysis</h4>
                        <p><strong>Total Mock Tests:</strong> ${appData.mockTests.length}</p>
                        <p><strong>Average Score:</strong> ${avgScore}%</p>
                        <p><strong>Errors Logged:</strong> ${appData.errors.length}</p>
                        <p style="margin-top: 1rem;">Based on your data, I recommend focusing on consistent practice. ${appData.errors.length > 0 ? 'Review your error log regularly to avoid repeating mistakes.' : 'Start logging your mistakes to track improvement areas.'}</p>
                    </div>
                `;
            }, 1500);
        }

        function generateWeaknessAnalysis() {
            const response = document.getElementById('aiResponse');
            response.classList.remove('hidden');
            response.innerHTML = '<div class="spinner"></div>';
            
            setTimeout(() => {
                const subjects = {};
                appData.errors.forEach(error => {
                    subjects[error.subject] = (subjects[error.subject] || 0) + 1;
                });
                
                const weakest = Object.entries(subjects).sort((a, b) => b[1] - a[1]);
                
                response.innerHTML = `
                    <div class="ai-message">
                        <h4 style="margin-bottom: 0.5rem;">üéØ Weakness Analysis</h4>
                        ${weakest.length > 0 ? `
                            <p><strong>Most Common Error Areas:</strong></p>
                            <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                ${weakest.map(([subject, count]) => `<li>${subject}: ${count} errors</li>`).join('')}
                            </ul>
                            <p style="margin-top: 1rem;">Focus your study efforts on ${weakest[0][0]} to see the biggest improvement.</p>
                        ` : '<p>No errors logged yet. Start tracking your mistakes to identify weak areas!</p>'}
                    </div>
                `;
            }, 1500);
        }

        function generateStudyPlan() {
            const response = document.getElementById('aiResponse');
            response.classList.remove('hidden');
            response.innerHTML = '<div class="spinner"></div>';
            
            setTimeout(() => {
                response.innerHTML = `
                    <div class="ai-message">
                        <h4 style="margin-bottom: 0.5rem;">üìù Study Plan Recommendation</h4>
                        <p><strong>Daily Schedule:</strong></p>
                        <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                            <li>Morning (2 hours): Quantitative Aptitude</li>
                            <li>Afternoon (2 hours): Verbal Ability & Reading</li>
                            <li>Evening (1.5 hours): Data Interpretation</li>
                            <li>Night (1 hour): Mock Test / Error Review</li>
                        </ul>
                        <p style="margin-top: 1rem;"><strong>Weekly Goals:</strong></p>
                        <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                            <li>Complete 3-4 full-length mock tests</li>
                            <li>Review all error logs from previous week</li>
                            <li>Study new concepts: 2-3 topics per subject</li>
                        </ul>
                    </div>
                `;
            }, 1500);
        }

        function askAIAdvisor() {
            const question = document.getElementById('aiQuestion').value.trim();
            if (!question) {
                showToast('Please enter a question', 'warning');
                return;
            }
            
            const response = document.getElementById('aiResponse');
            response.classList.remove('hidden');
            response.innerHTML = '<div class="spinner"></div>';
            
            // Simulated AI response
            setTimeout(() => {
                response.innerHTML = `
                    <div class="ai-message">
                        <p><strong>You asked:</strong> ${question}</p>
                        <p style="margin-top: 1rem;"><strong>AI Response:</strong></p>
                        <p>I understand you're asking about "${question}". To provide the most accurate advice, I need access to AI capabilities. In the full version, I would analyze your performance data and provide personalized recommendations.</p>
                        <p style="margin-top: 0.5rem;">For now, here's general advice: Stay consistent with your preparation, take regular mock tests, and always review your mistakes. Focus on understanding concepts rather than memorization.</p>
                    </div>
                `;
                document.getElementById('aiQuestion').value = '';
            }, 2000);
        }

        // Profile
        function loadProfile() {
            if (appData.profile) {
                document.getElementById('profileName').value = appData.profile.name || '';
                document.getElementById('targetExam').value = appData.profile.targetExam || 'CAT';
                document.getElementById('targetScore').value = appData.profile.targetScore || '';
                document.getElementById('targetColleges').value = appData.profile.targetColleges || '';
                document.getElementById('dailyGoal').value = appData.profile.dailyGoal || '';
            }
        }

        function saveProfile() {
            appData.profile = {
                name: document.getElementById('profileName').value.trim(),
                targetExam: document.getElementById('targetExam').value,
                targetScore: document.getElementById('targetScore').value,
                targetColleges: document.getElementById('targetColleges').value.trim(),
                dailyGoal: document.getElementById('dailyGoal').value
            };
            
            saveUserData();
            showToast('Profile saved!', 'success');
        }

        // Settings
        function exportToJSON() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `studybuddy-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            showToast('Data exported successfully!', 'success');
        }

        function exportToExcel() {
            // Simplified export - in production, use a library like SheetJS
            showToast('Excel export feature coming soon!', 'info');
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showToast('Please select a file', 'warning');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    appData = {
                        mockTests: imported.mockTests || [],
                        errors: imported.errors || [],
                        goals: imported.goals || [],
                        studySessions: imported.studySessions || [],
                        resources: imported.resources || [],
                        profile: imported.profile || {}
                    };
                    saveUserData();
                    refreshUI();
                    showToast('Data imported successfully!', 'success');
                } catch (error) {
                    showToast('Error importing file: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function confirmClearData() {
            if (confirm('Are you sure you want to clear all local data? Your Firebase data will remain safe.')) {
                appData = {
                    mockTests: [],
                    errors: [],
                    goals: [],
                    studySessions: [],
                    resources: [],
                    profile: {}
                };
                
                saveUserData();
                refreshUI();
                showToast('All data cleared!', 'info');
            }
        }

        // Dashboard
        function updateDashboard() {
            // Update stats
            document.getElementById('totalMockTests').textContent = appData.mockTests.length;
            document.getElementById('totalErrors').textContent = appData.errors.length;
            document.getElementById('totalGoals').textContent = appData.goals.length;
            
            // Calculate average score
            if (appData.mockTests.length > 0) {
                const avgScore = appData.mockTests.reduce((sum, test) => {
                    return sum + parseFloat(test.percentage);
                }, 0) / appData.mockTests.length;
                document.getElementById('avgScore').textContent = avgScore.toFixed(1) + '%';
            } else {
                document.getElementById('avgScore').textContent = '0%';
            }
            
            // Calculate study hours
            const totalHours = (appData.studySessions || []).reduce((sum, session) => {
                return sum + parseFloat(session.duration || 0);
            }, 0);
            document.getElementById('studyHours').textContent = totalHours.toFixed(1);
            
            // Calculate streak (simplified)
            document.getElementById('studyStreak').textContent = (appData.studySessions || []).length > 0 ? 'üî•' : '0';
            
            // Update chart
            createMockTrendChart();
            
            // Update recent sections
            renderRecentMocks();
            renderActiveGoals();
        }

        function createMockTrendChart() {
            const ctx = document.getElementById('performanceChart');
            if (!ctx) return;
            
            if (performanceChart) {
                performanceChart.destroy();
            }
            
            const sorted = [...appData.mockTests].sort((a, b) => new Date(a.date) - new Date(b.date));
            const labels = sorted.map(test => test.name);
            const scores = sorted.map(test => parseFloat(test.percentage));
            
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Score %',
                        data: scores,
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary'),
                        backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary') + '20',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Score: ' + context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderRecentMocks() {
            const container = document.getElementById('recentMocks');
            const recent = [...appData.mockTests].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 3);
            
            if (recent.length === 0) {
                container.innerHTML = '<p style="color: var(--color-text-secondary); text-align: center; padding: 1rem;">No mock tests yet</p>';
                return;
            }
            
            container.innerHTML = recent.map(test => `
                <div style="padding: 0.75rem 0; border-bottom: 1px solid var(--color-border);">
                    <div style="font-weight: 500;">${test.name}</div>
                    <div style="font-size: 0.85rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                        ${test.percentage}% ‚Ä¢ ${new Date(test.date).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }

        function renderActiveGoals() {
            const container = document.getElementById('activeGoals');
            const active = appData.goals.filter(g => !g.completed).slice(0, 3);
            
            if (active.length === 0) {
                container.innerHTML = '<p style="color: var(--color-text-secondary); text-align: center; padding: 1rem;">No active goals</p>';
                return;
            }
            
            container.innerHTML = active.map(goal => `
                <div style="padding: 0.75rem 0; border-bottom: 1px solid var(--color-border);">
                    <div style="font-weight: 500;">${goal.title}</div>
                    <div style="font-size: 0.85rem; color: var(--color-text-secondary); margin-top: 0.25rem;">
                        Due: ${new Date(goal.deadline).toLocaleDateString()}
                    </div>
                </div>
            `).join('');
        }

        // Utilities
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function continueOffline() {
            document.getElementById('offlineBanner').classList.remove('show');
        }

        function refreshUI() {
            renderMockTests();
            renderErrorLog();
            renderGoals();
            renderResources();
            renderStudyHistory();
            updateDashboard();
            lucide.createIcons();
        }

        // Network status
        window.addEventListener('online', () => {
            document.getElementById('offlineBanner').classList.remove('show');
            updateSyncStatus(true);
            showToast('Back online! Syncing data...', 'success');
            saveUserData();
        });

        window.addEventListener('offline', () => {
            document.getElementById('offlineBanner').classList.add('show');
            updateSyncStatus(false);
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set today's date for date inputs
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) input.value = today;
            });
            
            // Initialize theme
            const theme = 'light'; // Theme will be loaded from Firebase after auth
            document.documentElement.setAttribute('data-color-scheme', theme);
            
            // Initialize Lucide icons
            lucide.createIcons();
        });
    </script>
</body>
</html>
